.program i2s
.side_set 2 opt

; Programme minimal I²S : envoie un mot 32 bits (16 bits gauche + 16 bits droit)
; LRCLK bas = gauche, haut = droite
; BCLK généré par side_set

; Récupère un mot 32 bits du FIFO
pull block

; Canal gauche (16 bits)
set x, 15
left_loop:
    out pins, 1 side 0b00   ; LRCLK=0, envoie bit sur DIN
    nop       side 0b01     ; toggle BCLK
    jmp x-- left_loop

; Canal droit (16 bits)
set x, 15
right_loop:
    out pins, 1 side 0b10   ; LRCLK=1, envoie bit sur DIN
    nop       side 0b11     ; toggle BCLK
    jmp x-- right_loop

; Boucle infinie
jmp 0

.wrap
